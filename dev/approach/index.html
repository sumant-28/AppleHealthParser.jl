<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Method · AppleHealthParser.jl</title><meta name="title" content="Method · AppleHealthParser.jl"/><meta property="og:title" content="Method · AppleHealthParser.jl"/><meta property="twitter:title" content="Method · AppleHealthParser.jl"/><meta name="description" content="Documentation for AppleHealthParser.jl."/><meta property="og:description" content="Documentation for AppleHealthParser.jl."/><meta property="twitter:description" content="Documentation for AppleHealthParser.jl."/><meta property="og:url" content="https://sumant-28.github.io/AppleHealthParser.jl/approach/"/><meta property="twitter:url" content="https://sumant-28.github.io/AppleHealthParser.jl/approach/"/><link rel="canonical" href="https://sumant-28.github.io/AppleHealthParser.jl/approach/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AppleHealthParser.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../reference/">Reference</a></li><li class="is-active"><a class="tocitem" href>Method</a><ul class="internal"><li><a class="tocitem" href="#How-the-Data-is-Structured"><span>How the Data is Structured</span></a></li><li><a class="tocitem" href="#A-single-flat-table-is-not-a-suitable-export-format-for-this-data"><span>A single flat table is not a suitable export format for this data</span></a></li><li><a class="tocitem" href="#The-Processing-Method-needs-to-scale-with-Big-Data"><span>The Processing Method needs to scale with Big Data</span></a></li><li><a class="tocitem" href="#The-three-main-tags-for-which-elements-can-be-nested-are-the-export-object-names"><span>The three main tags for which elements can be nested are the export object names</span></a></li></ul></li><li><a class="tocitem" href="../overview/">Implementation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Method</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Method</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sumant-28/AppleHealthParser.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sumant-28/AppleHealthParser.jl/blob/main/docs/src/approach.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-Method"><a class="docs-heading-anchor" href="#The-Method">The Method</a><a id="The-Method-1"></a><a class="docs-heading-anchor-permalink" href="#The-Method" title="Permalink"></a></h1><p>There is no one correct way to parse this document. Many have been done before. The <a href="https://www.r-bloggers.com/2021/02/extracting-heart-rate-data-two-ways-from-apple-health-xml-export-files-using-r-a-k-a-the-least-romantic-valentines-day-r-post-ever/">first</a> and <a href="https://rpubs.com/heidithornton09/AccessingAppleHealthData">second</a> examples highlighted in R used the DOM API in the R XML parser module and as will be explained in this documentation does not seem scalable for years worth of data. The <a href="https://www.tdda.info/in-defence-of-xml-exporting-and-analysing-apple-health-data">first</a> and <a href="https://github.com/jameno/Simple-Apple-Health-XML-to-CSV">second</a> examples in Python2 and Python3 respectively are instructive and use a parser that doesn&#39;t load the entire file onto local memory. Those analyses overlap with what is presented in this documentation and source code but there are also some differences in approach. </p><h2 id="How-the-Data-is-Structured"><a class="docs-heading-anchor" href="#How-the-Data-is-Structured">How the Data is Structured</a><a id="How-the-Data-is-Structured-1"></a><a class="docs-heading-anchor-permalink" href="#How-the-Data-is-Structured" title="Permalink"></a></h2><p>Unlike other XML documents where the data is stored in the elements individually Apple has decided to store the strings containing data as attributes. There is also a nesting structure where elements of a certain title can have elements that themselves follow the same structure of data contained in attributes. The three types of nodes for which nesting can occur have the following titles &quot;ActivitySummary&quot;, &quot;Record&quot;, &quot;Workout&quot;. The full structure of the file is laid out in the DTD syntax.</p><h2 id="A-single-flat-table-is-not-a-suitable-export-format-for-this-data"><a class="docs-heading-anchor" href="#A-single-flat-table-is-not-a-suitable-export-format-for-this-data">A single flat table is not a suitable export format for this data</a><a id="A-single-flat-table-is-not-a-suitable-export-format-for-this-data-1"></a><a class="docs-heading-anchor-permalink" href="#A-single-flat-table-is-not-a-suitable-export-format-for-this-data" title="Permalink"></a></h2><p>It may be reasonable to think that because this document contains a series of nodes which each contain a set of attributes to create a dictionary for each node and convert that to appear all in the same dataframe. The image below shows some of the attributes are shared in common with three main nodes</p><p><img src="../assets/img/grid.png" alt="subet1"/></p><p>While there is some overlap in fields this visual shows that the resulting table of a simple export will have a lot of sparsity which is not efficient for storing larger data. Apple also deliberately seems to make some fields with similar properties have different names on purpose like in the naming convention of the date fields.</p><h2 id="The-Processing-Method-needs-to-scale-with-Big-Data"><a class="docs-heading-anchor" href="#The-Processing-Method-needs-to-scale-with-Big-Data">The Processing Method needs to scale with Big Data</a><a id="The-Processing-Method-needs-to-scale-with-Big-Data-1"></a><a class="docs-heading-anchor-permalink" href="#The-Processing-Method-needs-to-scale-with-Big-Data" title="Permalink"></a></h2><p>The most convenient and efficient method to extract data from a .xml file for analysis is to use the DOM API along with XPATH </p><p><img src="../assets/img/New Flowchart.jpg" alt="subet1"/></p><p>The following code snippet illustrates how any piece of data can be extracted as a vector and then used to make a graph or used for a regression</p><pre><code class="nohighlight hljs">using EzXML
filename = joinpath(dirname(pathof(AppleHealthParser)), &quot;..&quot;, &quot;test&quot;, &quot;data&quot;, &quot;reconstructed.xml&quot;)
doc = readxml(filename)
nodecontent.(findall(&quot;//Record//@value&quot;, doc))</code></pre><p>This grabs all the &quot;value&quot; values for each Record element in the file. Any other key is similarly accessible. The language this is written in is of course Julia but XPATH syntax is similar in other scientific computing languages. In user testing loading the data into local memory to facilitate this is not not reasonable for larger amounts of data that exceed 100,000 observations or so. Therefore the more convoluted process is followed in the flowchart above.</p><h2 id="The-three-main-tags-for-which-elements-can-be-nested-are-the-export-object-names"><a class="docs-heading-anchor" href="#The-three-main-tags-for-which-elements-can-be-nested-are-the-export-object-names">The three main tags for which elements can be nested are the export object names</a><a id="The-three-main-tags-for-which-elements-can-be-nested-are-the-export-object-names-1"></a><a class="docs-heading-anchor-permalink" href="#The-three-main-tags-for-which-elements-can-be-nested-are-the-export-object-names" title="Permalink"></a></h2><p>Whether it is a vector of dictionaries or DataFrames or .csv files it makes the most sense to export the data separated by whether it is a &quot;Record&quot;, &quot;ActivitySummary&quot; or &quot;Workout&quot;. This is because Apple has decided to nest metadata in these elements. The nested metadata sometimes makes sense out of this context but frequently does not.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../reference/">« Reference</a><a class="docs-footer-nextpage" href="../overview/">Implementation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Saturday 19 October 2024 01:19">Saturday 19 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
